@using WeatherDashboard.Models
@using WeatherDashboard.Services
@inject FavoritesService FavoritesService

<aside class="sidebar">
    <div class="sidebar-title">Kedvenc városok</div>

    @if (!FavoriteCities.Any())
    {
        <div class="sidebar-empty">
            Még nincsenek kedvenc városok.<br />
            Keressen egy várost és adja hozzá a kedvencekhez!
        </div>
    }
    else
    {
        <div class="sidebar-list">
            @foreach (var city in FavoriteCities)
            {
                <div class="sidebar-item" @onclick="() => OnCitySelected.InvokeAsync(city)">
                    <div class="sidebar-item-content">
                        <div class="sidebar-item-name">@city.Name</div>
                        <div class="sidebar-item-details">
                            @if (!string.IsNullOrEmpty(city.Admin1))
                            {
                                <span>@city.Admin1, </span>
                            }
                            <span>@city.Country</span>
                        </div>
                    </div>
                    <button class="sidebar-item-remove"
                            @onclick:stopPropagation="true"
                            @onclick="() => RemoveFavorite(city)"
                            title="Eltávolítás a kedvencek közül">
                        ★
                    </button>
                </div>
            }
        </div>
    }
</aside>

@code {
    [Parameter]
    public EventCallback<GeocodingResult> OnCitySelected { get; set; }

    [Parameter]
    public List<GeocodingResult> FavoriteCities { get; set; } = new();

    [Parameter]
    public EventCallback OnFavoritesChanged { get; set; }

    private async Task RemoveFavorite(GeocodingResult city)
    {
        await FavoritesService.RemoveFavoriteAsync(city);
        await OnFavoritesChanged.InvokeAsync();
    }
}
